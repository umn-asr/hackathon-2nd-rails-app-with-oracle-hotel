So far the commands that seem to be on the right track
for a deploy script are:

# Create remote context (will want to add a rm line on `script/shutdown`)
docker context create remote \
  --docker host=ssh://swadm@asr-drone-dev-app-01.oit.umn.edu

# build container on remote host
docker-compose -f docker-compose.yml -f docker-compose.prod.yml --context remote up -d

-----
However there were a lot of other discoveries that I've captured in the below notes.

Notes:
# create remote context

docker context create remote \
  --docker host=ssh://swadm@asr-drone-dev-app-01.oit.umn.edu

# seems like docker holds onto these contexts across projects.
# starting this in a new repo, I expected to have to create the
# context again but it was already there.
# may want to rm context on shutdown, and add on startup

# tried to `docker-compose up` like below
# various errors worked through
# - until `Error while fetching server API version`
# led to me to realize swadm didn't have the correct permissions

# then had to add swadm to docker group per link shared by Tony
# confirmed added correctly: after sign out, sign back - run `docker run hello-world` successful

# build container on remote host
# using remote context, docker-compose up
#     - I think this saying use the settings of docker-compose.yml, but override
#     docker-compose.yml with settings in docker-compose.prod.yml
docker-compose -f docker-compose.yml -f docker-compose.prod.yml --context remote up -d

# build seemed frozen so re-ran with --verbose
# build failed from line 11 RUN command in Dockerfile:
#     Err:1 http://deb.debian.org/debian buster InRelease
        Could not connect to debian.map.fastlydns.net:80 (199.232.30.132). - connect (113: No route to host) Unable to connect to deb.debian.org:http:
      Err:2 http://deb.debian.org/debian buster-updates InRelease
        Unable to connect to deb.debian.org:http:
      Err:3 http://security.debian.org/debian-security buster/updates InRelease
        Could not connect to debian.map.fastlydns.net:80 (199.232.30.132), connection timed out Could not connect to security.debian.org:80 (151.101.128.204). - connect (113: No route to host) Could not connect to security.debian.org:80 (151.101.64.204), connection timed out Could not connect to security.debian.org:80 (151.101.192.204), connection timed out Could not connect to security.debian.org:80 (151.101.0.204), connection timed out

# After further research, it seems like the ideal is to keep
# the same Dockerfile, and use ENV variables if you need to

# But I'm still unsure why build is failing

# After running the `up` command, now the error is:

E: Unable to locate package alien
E: Package 'build-essential' has no installation candidate
E: Unable to locate package freetds-dev
E: Unable to locate package libaio-dev
E: Unable to locate package libaio1

# Hangs for a long time at:

docker.api.build._set_auth_headers: Looking for auth config
docker.auth._resolve_authconfig_credstore: Looking for auth entry for 'https://asr-docker-local.artifactory.umn.edu'
docker.api.build._set_auth_headers: Sending auth config ('asr-docker-local.artifactory.umn.edu', 'https://asr-docker-local.artifactory.umn.edu')

# Research says this could be b/c it's passing a large file, not
# sure what that would be.

# It does eventually complete, however.

-----

The issue does appear to be a networking one.

I found you can run the command `docker info`.
Running that on both my local machine and the drone dev server,
one difference stands out.

On the drone server, at the very bottom, there is this warning:

```
WARNING: bridge-nf-call-iptables is disabled
WARNING: bridge-nf-call-ip6tables is disabled
```

I found online you can edit your `/etc/sysctl.conf` to say:

```
bridge-nf-call-iptables is disabled = 1
bridge-nf-call-ip6tables is disabled = 1
```

And that might fix it. However it doesn't seem like it's a
secure way, this file is read-only, and it doesn't seem like
something that would be easy to troubleshoot if this changes
in the future.

I'm wondering if there's a change to the `ipset` role we could
make for this playbook.
